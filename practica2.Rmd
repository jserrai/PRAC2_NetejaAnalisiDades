---
title: "practica2"
author: "Paula Jordi"
date: "30/12/2020"
output: pdf_document
---

```{r setup, include=FALSE} 
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Integració i selecció de les dades d’interès a analitzar:

Obtenim les dades del repositori: https://www.kaggle.com/lantanacamara/hong-kong-horse-racing
Aquest conté dades dels resultats de les 1561 curses de cavalls fetes a Hong Kong entre el 14 de Setembre del 2014 i el 16 de Juliol de 2017. Aquest està organitzat amb dos fitxers: race-result-horse.csv i race-result-race.csv:

```{r}
horse.data <- read.csv("./race-result-horse.csv")
race.data <- read.csv("./race-result-race.csv")
```

Unifiquem els dos datasets en un a partir de la variable comú als dos fitxers. Aquesta fa referencia al identificador de la carrera: "race_id"

```{r}
dataset <- merge(horse.data, race.data, by = "race_id")
attach(dataset) # Per poder fer referencia directament a les variables
dim(dataset)
```


## 2 .Neteja de les dades:

Abans de netejar les dades, hem de mirar què hi tenim a cada columna. Per fer-ho utilizarem la funció summary() que ens permet visualitzar i fer-nos una idea general general el dataset: 

```{r message= FALSE, warning=FALSE}
head(dataset,50)
str(dataset)
```

Com podem veure, tenim 30 variables amb 30189 observacions. Com que hi ha moltes variables que estan repetides o que no aporten una infromació vàlida, n'eliminarem algunes:

1. "incident_report": Són comentaris sobre la cursa, no utilitzarem aquesta variable per als nostres anàlisis, per tant els podem eliminar.
2. "running_position_X": Entenem que són les posicions intermitjes de la carrera. No ens aporta informació sobre abans de la carrera, sinó durant aquesta.
3. "SRC": Tampoc ens aporta res més que el nom dels fitxers de dades.
4. "horse_number": Depèn de cada cursa i no identifica el cavall, per tant deixem només el "horse_name".
5. "race_number": També és reduntant amb les altres variables.
6. "race_date": La data de la carrera és indiferent per l'anàlisi de les dades. 

```{r message= FALSE, warning=FALSE}
eliminar <- c("running_position_1","running_position_2","running_position_3","running_position_4","running_position_5","running_position_6","incident_report","src","race_date","race_number","horse_number","horse_id")
dataset_clean <- dataset[ , !(names(dataset) %in% eliminar)]
dataset_clean[] <- lapply(dataset_clean, as.character)
```


### 2.1. Les dades contenen zeros o elements buits? Com gestionaries aquests casos?

Fent una ullada al dataset, veiem que a la variable finishing_position, hi ha valors no numèrics. Aquests no ens aporten informació útil per a obtenir el nostre resultat.
Per tant, eliminem aquestes files del dataset.

```{r message= FALSE, warning=FALSE}
dataset_clean$finishing_position <- lapply(dataset_clean$finishing_position, as.integer) # tots aquells valors que no s'hagin pogut transformar són els no numèrics, i restaran com a "NA".

dataset_clean <- dataset_clean[!(is.na(dataset_clean$finishing_position)),] # eliminem les files sense resultats.
```

Fent una ullada al dataset, veiem que alguns valors NA estan representats com a "---", "N", "SH" o "HD". Canviarem aquests valors a NA per a poder treballar amb la mateixa notació. 
A més a més, a la columna de "length_behind_winner" (la distància del cavall en qüestió en relació al primer), ens trobem valors representats com a "-". Aquests corresponen al guanyador de la cursa, el quel no té distància sobre sí mateix, és a dir no són valors buits sinó que representen distància 0. Modificarem la notació per "0".

```{r echo=TRUE, message=FALSE, warning=FALSE}
dataset_clean[dataset_clean == "-"] <- "0"
dataset_clean[dataset_clean == "---"] <- NA
dataset_clean[dataset_clean == "N"] <- NA
dataset_clean[dataset_clean == "SH"] <- NA
dataset_clean[dataset_clean == "HD"] <- NA
```

Un cop ja tenim tots els valors buits amb la mateixa identificació, podem mirar si tenim gaires elements buits, i en quines variables.

```{r echo=TRUE, message=FALSE, warning=FALSE}
paste("Nombre de valors nulls:", sum(is.na(race_id)))
colSums(is.na(dataset_clean))
```

En el nostre cas, no tenim valors buits en les columnes després de netejar les variables. Només en tenim a la variable length_behind_winner. I representa molt poc percentatge de les dades totals:

```{r echo=TRUE, message=FALSE, warning=FALSE}
paste("Proporció de valors nulls de la variable length_behind_winner:", format(sum(is.na(dataset_clean$length_behind_winner))/nrow(dataset_clean), format = "f", digits = 3), "%")
```

Tot i així, si mirem al dataset original, veiem que hi havia bastants valors buits. Aquests, estaven concentrats en les columnes que hem eliminat perque no ens aportaven informació útil.

```{r echo=TRUE, message=FALSE, warning=FALSE}
#summary(dataset[,-30])
colSums(is.na(dataset))
```

### 2.2. Identificació i tractament de valors extrems

Per a visualitzar els valors extrems, primer escollirem aquelles variables en les quals podem trobar-nos valors extrems.
De totes les variables del nostre dataset, aquelles que categòriques o identificatives no tindran valors extrems  ("race_id", "horse_name", "jockey", "trainer", "draw", "race_course", "race_name", "race_class", "track", "track_condition", "finishing_position").

